<div class="collection-header">
  <div class="collection-header__image">
    <figure class="lazy" data-src="{% if collection.image != blank %}{{ collection.image | img_url: '3000x', format: 'pjpg'}}{% endif %}">
      <figcaption class="visually-hidden">
        {% if collection.image.alt != blank %}
          {{ collection.image.alt }}
        {% else %}
          {{ collection.title }}{% endif %}
      </figcaption>
    </figure>
    <div class="collection-header__title {% if collection.image != blank %}collection-header__title--has-image{% endif %}">
      <h1>{{ collection.title }}</h1>
    </div>
  </div>
  <div class="collection-header__actions">
    <div class="collection-header__breadcrumbs">
      {% include 'page-utility' %}
    </div>
    <div class="collection-header__filtering-toggle">
      <span>Filter</span>
      {% include 'icon-sliders.svg' %}
    </div>
    <div class="collection-header__sorting">
      {% include 'collection-sort' %}
    </div>
  </div>
</div>

<main class="content content--has-sidebar" role="main">
  <div class="collection-sidebar">
    {% include 'collection-filtering' %}
  </div>
  <div class="collection-main">
    <div class="row row--gutters products" id="ProductGridContainer">
      {% if collection.products.size < 1 %}
        <p class="no-products column--xs-12">Sorry
          nothing is available at the moment.</p>
      {% else %}
        
     {% for prod in collection.products %}
      {% if prod.object_type == 'product' and prod.type == 'SHOPSTORM_HIDDEN_PRODUCT' %}{% continue %}{% endif %}
<!-- //code -->





      
{% comment %} Wholesale_Club_Product_Prices Start {% endcomment %}
{% assign base_product = product %}
{% assign base_variant = product.selected_or_first_available_variant %}

{% if shop.metafields.sawholesale['base_price'] == blank %}
  {% assign base_price = 'compare_at_price' %}
{% else %}
  {% assign base_price = shop.metafields.sawholesale['base_price'] %}
{% endif %}

{% assign saw_discount = 0 %}{% assign saw_has_discount = false %}

{% if customer.tags != blank %}
  {% for mf in base_product.metafields.sawholesale %}
    {% capture product_customer_tag %}{{ mf | first | replace: 'discount_', '' }}{% endcapture %}
    {% if customer.tags contains product_customer_tag %}
      {% assign saw_has_discount = true %}
      {% assign discount_key = product_customer_tag | prepend: 'discount_' %}
      {% assign price_key = product_customer_tag | prepend: 'price_' %}
      {% assign saw_discount = base_product.metafields.sawholesale[discount_key] | divided_by: 100.0 %}
    {% endif %}
  {% endfor %}
{% endif %}

{% assign saw_discount = 1 | minus: saw_discount %}

{% if base_price == 'price' or base_variant.compare_at_price == blank  or base_variant.compare_at_price == 0 or base_variant.compare_at_price < base_variant.price %}
  {% assign saw_variant_compare_at_price = base_variant.price %}
{% else %}
  {% assign saw_variant_compare_at_price = base_variant.compare_at_price %}
{% endif %}

{% assign cpe = shop.metafields.sawholesale['cpe'] | default: "true" %}
{% if base_variant.metafields.sawholesale[price_key] != blank and cpe == "true" %}
  {% assign saw_variant_price = base_variant.metafields.sawholesale[price_key] %}
{% else %}
  {% assign saw_variant_price = saw_variant_compare_at_price | times: saw_discount %}
{% endif %}

{% if saw_has_discount == false or saw_variant_price >= saw_variant_compare_at_price %}
  {% assign WCProduct_Price = base_product.price %}
  {% assign WCProduct_ComparePrice = base_product.compare_at_price %}
  {% assign WCProduct_PriceMin = base_product.price_min %}
  {% assign WCProduct_ComparePriceMin = base_product.compare_at_price_min %}
  {% assign WCProduct_PriceMax = base_product.price_max %}
  {% assign WCProduct_ComparePriceMax = base_product.compare_at_price_max %}
  {% assign WCProduct_VariantPrice = base_variant.price %}
  {% assign WCProduct_VariantComparePrice = base_variant.compare_at_price %}
{% else %}   
  {% assign WCProduct_Price = saw_variant_price %}
  {% assign WCProduct_PriceMin = base_product.price_min | times: saw_discount %}
  {% assign WCProduct_PriceMax = base_product.price_max | times: saw_discount %}
  {% assign WCProduct_ComparePrice = saw_variant_compare_at_price %}
  {% if base_product.compare_at_price_min != 0 %}{% assign WCProduct_ComparePriceMin = base_product.compare_at_price_min %}{% else %}{% assign WCProduct_ComparePriceMin = base_product.price_min %}{% endif %}
  {% if base_product.compare_at_price_max != 0 %}{% assign WCProduct_ComparePriceMax = base_product.compare_at_price_max %}{% else %}{% assign WCProduct_ComparePriceMax = base_product.price_max %}{% endif %}
  {% assign WCProduct_VariantPrice = saw_variant_price %}
  {% assign WCProduct_VariantComparePrice = saw_variant_compare_at_price %}
{% endif %}
{% comment %} Wholesale_Club_Product_Prices End {% endcomment %}
{% assign variant = prod.variants.first %}

<article itemtype="http://schema.org/Product" itemscope="itemscope" class="{% if prod.available == false%}product--unavailable {% endif %}column {% if classes %}{{ classes }}{% else %}column--xs-12 column--sm-6 column--sm-stretch column--md-4 column--md-stretch column--lg-3 column--lg-stretch{% endif %} product product--{{ prod.id }} product--{{ forloop.index }}{% if prod.compare_at_price_max > prod.price %} product--on-sale{% endif %}"{% if template contains 'collection' or template contains 'index' %} data-prod-id="{{ prod.id }}"{% endif %}>
  <div class="product__content">
    <div class="product__badges">
      {% if prod.compare_at_price_max > prod.price %}
        {% assign difference = WCProduct_VariantComparePrice | minus: WCProduct_VariantPrice %}
        <div class="product__badge product__badge--sale">Save {{ difference | money_without_trailing_zeros }}</div>
      {% endif %}
    </div>
    <a itemprop="url" class="product__image-wrapper" href="{{ prod.url | within: collection }}" title="{{ prod.title | strip_html | escape }}">
      {% assign featured_image = prod.selected_or_first_available_variant.featured_image | default: prod.featured_image %}
      <noscript>
        <img itemprop="image" class="product__image product__image--{{ prod.id }}" srcset="{{ prod.featured_image | img_url: '800x' }} 2x, {{ prod.featured_image | img_url: '400x' }} 1x" src="{{ prod.featured_image | img_url: '400x' }}" data-default-image="{{ prod.featured_image | img_url: '800x' }}" alt="{% if prod.featured_image.alt != blank %}{{ prod.featured_image.alt | escape }}{% else %}{{ prod.title | escape}}{% endif %}">
      </noscript>
        <img itemprop="image" class="product__image product__image--{{ prod.id }}" srcset="{{ prod.featured_image | img_url: '800x' }} 2x, {{ prod.featured_image | img_url: '400x' }} 1x" src="{{ prod.featured_image | img_url: '400x' }}" data-default-image="{{ prod.featured_image | img_url: '800x' }}" alt="{% if prod.featured_image.alt != blank %}{{ prod.featured_image.alt | escape }}{% else %}{{ prod.title | escape}}{% endif %}">
      <!-- <img itemprop="image" class="product__image product__image--{{ prod.id }} lazy" data-srcset="{{ prod.featured_image | img_url: '800x' }} 2x, {{ prod.featured_image | img_url: '400x' }} 1x" data-src="{{ prod.featured_image | img_url: '400x' }}" data-default-image="{{ prod.featured_image | img_url: '800x' }}" alt="{% if prod.featured_image.alt != blank %}{{ prod.featured_image.alt | escape }}{% else %}{{ prod.title | escape}}{% endif %}"> -->
    </a>
    <header class="product__header">
      <h2 class="product__title">
        <a href="{{ prod.url | within: collection }}" title="{{ prod.title | strip_html | escape }}" itemprop="name">{{ prod.title }}</a>
      </h2>
      <span class="on-sale">{{ prod.price | money }}</span>
      <span class="product__meta product__meta--pricing" itemprop="offers" itemtype="http://schema.org/Offer" itemscope="itemscope">
        {% if prod.available or prod.tags contains "neversoldout" %}
          <meta itemprop="priceCurrency" content="{{ shop.currency }}">
          {% if prod.compare_at_price_max > prod.price %}
            <span class="product__old-price">
            {{ prod.compare_at_price_max | money }}
              {% if WCProduct_VariantComparePrice > 0 %}
                 {{ WCProduct_VariantComparePrice | money }}
              {% endif %}
            </span>
          {% endif %}
          <span class="product__price"  itemprop="price">{{ WCProduct_VariantPrice | money }}</span>
        {% else %}
          <span class="product__price">SOLD OUT</span>
        {% endif %}
      </span>
    </header>
  </div>
</article>









      

      
          <!-- {% include 'custom-product-loop', classes: "column--xs-6 column--lg-4" %} -->
        {% endfor %}
      {% endif %}
    </div>
  </div>
</main>

<script type="text/template" id="no-product-found-message">
  <div class="no-products-found">{{ section.settings.none_found_message }}</div>
</script>

{% for block in section.blocks %}
  <script type="text/template" class="video-promo-block video-promo-block--{{ block.id }}">
    {% case block.settings.video_url.type %}
      {% when 'vimeo' %}
      {% capture player_src %}https://player.vimeo.com/video/{{ block.settings.video_url.id }}?title=0&byline=0&portrait=0&autoplay=1{% endcapture %}
      {% when 'youtube' %}
      {% capture player_src %}https://www.youtube.com/embed/{{ block.settings.video_url.id }}?autoplay=1{% endcapture %}
    {% endcase %}
    <section
      class="section product section--video video video--{{ block.id }} {% if block.settings.link_url != blank %}video--regular-link{% endif %} column column--xs-12 column--lg-8"
      data-position="{{ block.settings.position_index }}"
      data-src="{% if block.settings.video_url != blank %}{{ player_src }}{% else %}{{ block.settings.link_url }}{% endif %}">
      <div class="section-content{% unless block.settings.padding %} section-content--padding-none{% endunless %}">
        <figure class="lazy video__image" data-src="{{ block.settings.image | img_url: '3000x' }}">
          <figcaption class="video__content">
            <span class="video__subheading">{{ block.settings.preheading }}</span>
            {% if block.settings.video_url != blank %}
              <div class="video__play">{% include 'icon-play.svg' %}</div>
            {% endif %}
            <h3 class="video__heading">{{ block.settings.title }}</h3>
          </figcaption>
        </figure>
      </div>
      {% if block.settings.bg_overlay_color != blank %}
        {% assign is_none = false %}
        {% if block.settings.bg_overlay_color == 'rgba(0,0,0,0)' %}
          {% assign is_none = true %}{% endif %}
        <style>
          .video--{{ block.id }}.video__image:after {
            {% if is_none %}
              background-color: {{ block.settings.bg_overlay_color }}
              ;
            {% else %}
              background-color: {{ block.settings.bg_overlay_color | color_modify: 'alpha', 0.75 }}
              ;
            {% endif %}
          }
        </style>
      {% endif %}
    </section>
  </script>
{% endfor %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    (function($) {
      $(function() {
        $('#sort-by-select').val('{{ collection.sort_by | default: collection.default_sort_by | escape }}').bind('change', function() {
          REBASE.theme.collection.sortKey = $(this).val();
          $(document).trigger('collection_sort_by_change');
          location.reload();
        });

        function insertPromoBlocks() {
          var promo_templates = $('.video-promo-block');

          promo_templates.each(function(indx, val) {
            var html = $(val).html(),
              $el = $(html),
              position = $el.data('position');

            $el.insertBefore($('.products .product:nth-child(' + position + ')'));
          });

          REBASE_LazyLoad && REBASE_LazyLoad.update();
        }

        {% if section.blocks %}insertPromoBlocks();
          document.addEventListener('shopify:section:load', insertPromoBlocks){% endif %}
      });
    })(jQuery)
  });
</script>


{% schema %}
  {
    "name": "Rods Collection",
    "settings": [
      {
        "type": "textarea",
        "id": "none_found_message",
        "label": "No Products Found Message",
        "info": "Message displayed when applied filters return no results",
        "default": "No rods found &mdash; please adjust your filters"
      }
    ],
    "blocks": [
      {
        "type": "promo",
        "name": "Collection Promo",
        "settings": [
          {
            "type": "text",
            "id": "position_index",
            "label": "Position of Promo in collection",
            "default": "4"
          },
          {
            "type": "text",
            "id": "preheading",
            "label": "Pre Heading"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Heading"
          },
          {
            "type": "video_url",
            "id": "video_url",
            "label": "Video URL",
            "accept": [
              "vimeo", "youtube"
            ],
            "info": "Leave blank to use Link URL"
          }, {
            "type": "url",
            "id": "link_url",
            "label": "Link URL",
            "info": "Leave blank to use Video URL"
          }, {
            "type": "image_picker",
            "id": "image",
            "label": "Placeholder Image"
          }, {
            "type": "color",
            "id": "bg_overlay_color",
            "label": "Background Overlay Color"
          }
        ]
      }
    ]
  }
{% endschema %}